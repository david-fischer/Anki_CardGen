

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>utils &mdash; ACG 0.3.0 documentation</title>



  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />







  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->


      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>

    <script type="text/javascript" src="../_static/js/theme.js"></script>


    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
</head>

<body class="wy-body-for-nav">


  <div class="wy-grid-for-nav">

    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >



            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> ACG



          </a>







<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>


        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">






              <ul>
<li class="toctree-l1"><a class="reference internal" href="../word_processing.html">Word Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ui.html">UI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main.html">main</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">utils</a></li>
</ul>



        </div>

      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">


      <nav class="wy-nav-top" aria-label="top navigation">

          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ACG</a>

      </nav>


      <div class="wy-nav-content">

        <div class="rst-content">

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">

      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>

          <li><a href="index.html">Module code</a> &raquo;</li>

      <li>utils</li>


      <li class="wy-breadcrumbs-aside">

      </li>

  </ul>


  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <h1>Source code for utils</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains lots of helper functions.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="kn">import</span> <span class="nn">imgkit</span>
<span class="kn">import</span> <span class="nn">pystache</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">kivy.clock</span> <span class="kn">import</span> <span class="n">mainthread</span>
<span class="kn">from</span> <span class="nn">kivy.core.image</span> <span class="kn">import</span> <span class="n">Image</span> <span class="k">as</span> <span class="n">KivyImage</span>
<span class="kn">from</span> <span class="nn">kivy.core.window</span> <span class="kn">import</span> <span class="n">Window</span>
<span class="kn">from</span> <span class="nn">kivy.graphics.context_instructions</span> <span class="kn">import</span> <span class="n">Scale</span><span class="p">,</span> <span class="n">Translate</span>
<span class="kn">from</span> <span class="nn">kivy.graphics.fbo</span> <span class="kn">import</span> <span class="n">Fbo</span>
<span class="kn">from</span> <span class="nn">kivy.graphics.gl_instructions</span> <span class="kn">import</span> <span class="n">ClearBuffers</span><span class="p">,</span> <span class="n">ClearColor</span>
<span class="kn">from</span> <span class="nn">kivymd.app</span> <span class="kn">import</span> <span class="n">MDApp</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">spacy</span>

<div class="viewcode-block" id="SPACY_IS_AVAILABLE"><a class="viewcode-back" href="../utils.html#utils.SPACY_IS_AVAILABLE">[docs]</a>    <span class="n">SPACY_IS_AVAILABLE</span> <span class="o">=</span> <span class="kc">True</span></div>
    <span class="sd">&quot;&quot;&quot;``True`` if spacy could be imported, else ``False``&quot;&quot;&quot;</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;Spacy is not available, fall back to limited version. &quot;</span>
        <span class="s2">&quot;This means, words will not be lemmatized in the clean-up&quot;</span>
    <span class="p">)</span>
    <span class="n">SPACY_IS_AVAILABLE</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="COLOR2MEANING"><a class="viewcode-back" href="../utils.html#utils.COLOR2MEANING">[docs]</a><span class="n">COLOR2MEANING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;highlight_yellow&quot;</span><span class="p">:</span> <span class="s2">&quot;words&quot;</span><span class="p">,</span>
    <span class="s2">&quot;highlight_blue&quot;</span><span class="p">:</span> <span class="s2">&quot;phrases&quot;</span><span class="p">,</span>
    <span class="s2">&quot;highlight_pink&quot;</span><span class="p">:</span> <span class="s2">&quot;sentences&quot;</span><span class="p">,</span>
    <span class="s2">&quot;highlight_orange&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span></div>
<span class="p">}</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Dictionary relating highlight colors to the things that are highlighted with them.</span>
<span class="sd">Currently only ``COLOR2MEANING[&quot;highlight_yellow&quot;] = &quot;words&quot;`` is used.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">MEANING2COLOR</span> <span class="o">=</span> <span class="p">{</span><span class="n">val</span><span class="p">:</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">COLOR2MEANING</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="n">nlp</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># pylint: disable = invalid-name</span>


<span class="c1"># GENERAL</span>


<div class="viewcode-block" id="CD"><a class="viewcode-back" href="../utils.html#utils.CD">[docs]</a><span class="k">class</span> <span class="nc">CD</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Context manager for changing the current working directory to :attr:`new_path`.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_path</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saved_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="save_dict_to_csv"><a class="viewcode-back" href="../utils.html#utils.save_dict_to_csv">[docs]</a><span class="k">def</span> <span class="nf">save_dict_to_csv</span><span class="p">(</span><span class="n">some_dict</span><span class="p">,</span> <span class="n">out_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves dictionary as row to csv.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">is_first_entry</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">some_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">is_first_entry</span><span class="p">:</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">some_dict</span><span class="p">)</span></div>


<div class="viewcode-block" id="load_dicts_from_csv"><a class="viewcode-back" href="../utils.html#utils.load_dicts_from_csv">[docs]</a><span class="k">def</span> <span class="nf">load_dicts_from_csv</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads csv. Has to have the keys as first line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        : List of dictionaries.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">read_obj</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">read_obj</span><span class="p">))</span></div>


<div class="viewcode-block" id="smart_loader"><a class="viewcode-back" href="../utils.html#utils.smart_loader">[docs]</a><span class="k">def</span> <span class="nf">smart_loader</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses file ending of path to determine which function to use to load file.</span>

<span class="sd">    Supported file endings:</span>
<span class="sd">        * .p (pickle)</span>
<span class="sd">        * .csv</span>
<span class="sd">        * .json</span>

<span class="sd">    Args:</span>
<span class="sd">      path: Path of file to load.</span>

<span class="sd">    Returns:</span>
<span class="sd">      : Loaded object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;p&quot;</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">load_dicts_from_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">Exception</span></div>


<div class="viewcode-block" id="smart_saver"><a class="viewcode-back" href="../utils.html#utils.smart_saver">[docs]</a><span class="k">def</span> <span class="nf">smart_saver</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses file ending of path to determine which function to use to save file.</span>

<span class="sd">    Supported file endings:</span>
<span class="sd">        * .p (pickle)</span>
<span class="sd">        * .csv</span>
<span class="sd">        * .json</span>

<span class="sd">    Args:</span>
<span class="sd">      obj: Object to save.</span>
<span class="sd">      path: Path where object should be stored.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;p&quot;</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
        <span class="n">save_dict_to_csv</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="now_string"><a class="viewcode-back" href="../utils.html#utils.now_string">[docs]</a><span class="k">def</span> <span class="nf">now_string</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Returns:</span>
<span class="sd">      : Current time in the format ``YYYY-MM-DD_HH:MM:SS``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span></div>


<span class="c1"># KIVY</span>


<div class="viewcode-block" id="set_screen"><a class="viewcode-back" href="../utils.html#utils.set_screen">[docs]</a><span class="k">def</span> <span class="nf">set_screen</span><span class="p">(</span><span class="n">screen_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets current screen to the one with name ``screen_name``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">widget_by_id</span><span class="p">(</span><span class="s2">&quot;screen_man&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="n">screen_name</span></div>


<div class="viewcode-block" id="widget_by_id"><a class="viewcode-back" href="../utils.html#utils.widget_by_id">[docs]</a><span class="k">def</span> <span class="nf">widget_by_id</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get widget by string of ids, seperated by &quot;/&quot;.</span>

<span class="sd">    Args:</span>
<span class="sd">      string: Stings of ids, seperated by &quot;/&quot;. The first one can be a screen name.</span>

<span class="sd">    Returns:</span>
<span class="sd">      : widget</span>

<span class="sd">    Examples</span>
<span class="sd">      &gt;&gt;&gt; widget_by_id(&quot;screen_single_word/edit_tab/word_prop&quot;)</span>
<span class="sd">      MDApp.get_running_app().root.ids.screen_man.get_screen(&quot;screen_single_word&quot;).children[</span>
<span class="sd">      0].ids.word_prop</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">id_list</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="n">id_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">id_str</span> <span class="k">for</span> <span class="n">id_str</span> <span class="ow">in</span> <span class="n">id_list</span> <span class="k">if</span> <span class="n">id_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">MDApp</span><span class="o">.</span><span class="n">get_running_app</span><span class="p">()</span><span class="o">.</span><span class="n">root</span>
    <span class="k">if</span> <span class="n">id_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">screen_man</span><span class="o">.</span><span class="n">screen_names</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">screen_man</span><span class="o">.</span><span class="n">get_screen</span><span class="p">(</span><span class="n">id_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">id_str</span> <span class="ow">in</span> <span class="n">id_list</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">id_str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span></div>


<div class="viewcode-block" id="sleep_decorator"><a class="viewcode-back" href="../utils.html#utils.sleep_decorator">[docs]</a><span class="k">def</span> <span class="nf">sleep_decorator</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes sleep(time) before and after decorated function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">the_real_decorator</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

            <span class="n">sleep</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
            <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">sleep</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">the_real_decorator</span></div>


<span class="nd">@sleep_decorator</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nd">@mainthread</span>
<div class="viewcode-block" id="screenshot"><a class="viewcode-back" href="../utils.html#utils.screenshot">[docs]</a><span class="k">def</span> <span class="nf">screenshot</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes screenshot of the current state of the app and saves it under ``path``.</span>

<span class="sd">    The sleep- and mainthread-decorator ensure that the app shows the current state properly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">root_widget</span> <span class="o">=</span> <span class="n">MDApp</span><span class="o">.</span><span class="n">get_running_app</span><span class="p">()</span><span class="o">.</span><span class="n">root</span>

    <span class="n">fbo</span> <span class="o">=</span> <span class="n">Fbo</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">root_widget</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">root_widget</span><span class="o">.</span><span class="n">height</span><span class="p">),</span> <span class="n">with_stencilbuffer</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>

    <span class="k">with</span> <span class="n">fbo</span><span class="p">:</span>
        <span class="n">ClearColor</span><span class="p">(</span><span class="o">*</span><span class="n">MDApp</span><span class="o">.</span><span class="n">get_running_app</span><span class="p">()</span><span class="o">.</span><span class="n">theme_cls</span><span class="o">.</span><span class="n">bg_normal</span><span class="p">)</span>
        <span class="n">ClearBuffers</span><span class="p">()</span>
        <span class="n">Scale</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Translate</span><span class="p">(</span><span class="o">-</span><span class="n">root_widget</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">root_widget</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">root_widget</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">fbo</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">root_widget</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
    <span class="n">fbo</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">KivyImage</span><span class="p">(</span><span class="n">fbo</span><span class="o">.</span><span class="n">texture</span><span class="p">)</span>

    <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="make_screenshots"><a class="viewcode-back" href="../utils.html#utils.make_screenshots">[docs]</a><span class="k">def</span> <span class="nf">make_screenshots</span><span class="p">(</span><span class="n">window_size</span><span class="o">=</span><span class="p">(</span><span class="mi">270</span> <span class="o">*</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mi">480</span> <span class="o">*</span> <span class="mf">1.4</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;Set the app in a number of predefined states and takes a screenshot of each.&quot;&quot;&quot;</span>
    <span class="n">old_size</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">size</span>
    <span class="n">Window</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">window_size</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">widget_by_id</span><span class="p">(</span><span class="s2">&quot;drawer_list&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
        <span class="n">item</span><span class="o">.</span><span class="n">on_release</span><span class="p">()</span>
        <span class="n">screenshot</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;screenshots/</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
    <span class="n">widget_by_id</span><span class="p">(</span><span class="s2">&quot;nav_drawer&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">)</span>
    <span class="n">screenshot</span><span class="p">(</span><span class="s2">&quot;../screenshots/nav_drawer_open.png&quot;</span><span class="p">)</span>
    <span class="n">widget_by_id</span><span class="p">(</span><span class="s2">&quot;nav_drawer&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="s2">&quot;close&quot;</span><span class="p">)</span>
    <span class="c1"># Word</span>
    <span class="n">word_prop</span> <span class="o">=</span> <span class="n">widget_by_id</span><span class="p">(</span><span class="s2">&quot;screen_single_word/edit_tab/word_prop/&quot;</span><span class="p">)</span>
    <span class="n">word_prop</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">search_field</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;casa&quot;</span>
    <span class="n">word_prop</span><span class="o">.</span><span class="n">load_or_search</span><span class="p">(</span><span class="s2">&quot;casa&quot;</span><span class="p">)</span>
    <span class="n">screenshot</span><span class="p">(</span><span class="s2">&quot;../screenshots/example_word_text.png&quot;</span><span class="p">)</span>
    <span class="n">tabs</span> <span class="o">=</span> <span class="n">widget_by_id</span><span class="p">(</span><span class="s2">&quot;screen_single_word/tabs&quot;</span><span class="p">)</span>
    <span class="n">tabs</span><span class="o">.</span><span class="n">carousel</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># (tabs.carousel, 1)</span>
    <span class="n">screenshot</span><span class="p">(</span><span class="s2">&quot;../screenshots/example_word_images.png&quot;</span><span class="p">)</span>
    <span class="n">Window</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">old_size</span></div>


<span class="n">rend</span> <span class="o">=</span> <span class="n">pystache</span><span class="o">.</span><span class="n">Renderer</span><span class="p">(</span><span class="n">escape</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="p">)</span>


<div class="viewcode-block" id="save_card_pngs"><a class="viewcode-back" href="../utils.html#utils.save_card_pngs">[docs]</a><span class="k">def</span> <span class="nf">save_card_pngs</span><span class="p">(</span><span class="n">word</span><span class="o">=</span><span class="s2">&quot;casa&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">540</span><span class="p">,</span> <span class="mi">960</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves pngs of the anki-cards for a given word, for which a card has to be generated earlier.</span>

<span class="sd">    Args:</span>
<span class="sd">      word:  (Default value = &quot;casa&quot;)</span>
<span class="sd">      size:  (Default value = (540,960))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="s2">&quot;anki/*.html&quot;</span><span class="p">)</span>
    <span class="n">field_dict</span> <span class="o">=</span> <span class="n">smart_loader</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../app_data/words/</span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2">_card.json&quot;</span><span class="p">)</span>
    <span class="n">field_dict</span><span class="p">[</span><span class="s2">&quot;Audio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&amp;#9658;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="s2">&quot;anki/js&quot;</span><span class="p">,</span> <span class="s2">&quot;/tmp/js/&quot;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="s2">&quot;anki/css&quot;</span><span class="p">,</span> <span class="s2">&quot;/tmp/css/&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;JS AND CSS FOLDER ALREADY EXIST IN /tmp/ skip copying.&quot;</span><span class="p">)</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../app_data/words/</span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2">.jpg&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;/tmp/</span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2">.jpg&quot;</span><span class="p">)</span>
    <span class="n">compress_img</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/tmp/</span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2">.jpg&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">12</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../screenshots/</span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">rend</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="o">**</span><span class="n">field_dict</span><span class="p">)</span>
        <span class="n">imgkit</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span>
            <span class="n">string</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;../screenshots/</span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),},</span></div>
        <span class="p">)</span>


<div class="viewcode-block" id="selection_helper"><a class="viewcode-back" href="../utils.html#utils.selection_helper">[docs]</a><span class="k">def</span> <span class="nf">selection_helper</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">id_str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">      base:</span>
<span class="sd">      id_str:  (Default value = None)</span>
<span class="sd">      props:  (Default value = None)</span>

<span class="sd">    Returns:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">props</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">props</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
    <span class="n">base_obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="n">id_str</span><span class="p">)</span> <span class="k">if</span> <span class="n">id_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">base</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">base_obj</span><span class="o">.</span><span class="n">get_checked</span><span class="p">(</span><span class="n">property_name</span><span class="o">=</span><span class="n">prop</span><span class="p">)</span> <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">props</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">iconcat</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="p">[])</span></div>


<span class="c1"># KINDLE EXPORT PARSING</span>


<div class="viewcode-block" id="dict_from_kindle_export"><a class="viewcode-back" href="../utils.html#utils.dict_from_kindle_export">[docs]</a><span class="k">def</span> <span class="nf">dict_from_kindle_export</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts highlighted parts and sorts them by color in a dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">      file_path: Path to an html-file exported from kindle.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :Dictionary `{&quot;highlight_color_1&quot; : [&quot;list&quot;, &quot;of&quot; , &quot;highlighted parts&quot;, ...],...}`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;lxml&quot;</span><span class="p">)</span>
    <span class="n">heading_tags</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;div.noteHeading span&quot;</span><span class="p">)</span>
    <span class="n">highlight_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">heading_tags</span><span class="p">:</span>
        <span class="n">highlight_dict</span><span class="p">[</span><span class="n">tag</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">find_next</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">highlight_dict</span></div>


<div class="viewcode-block" id="clean_up"><a class="viewcode-back" href="../utils.html#utils.clean_up">[docs]</a><span class="k">def</span> <span class="nf">clean_up</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">remove_punct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lower_case</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lemmatize</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Preprocess a list of words (or phrases).</span>

<span class="sd">    Args:</span>
<span class="sd">      words: List of words</span>
<span class="sd">      remove_punct: If True, removes trailing and leading punctuation. (Default value = True)</span>
<span class="sd">      lower_case: If True, converts everything to lower case. (Default value = True)</span>
<span class="sd">      lemmatize: If True, tries to convert each word to its dictionary-form. (Default value = True)</span>

<span class="sd">    Returns:</span>
<span class="sd">        : List of processed words (or phrases).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">remove_punct</span><span class="p">:</span>
        <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;,.;:-–—!?¿¡</span><span class="se">\&quot;</span><span class="s2">&#39;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">lower_case</span><span class="p">:</span>
        <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">lemmatize</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">SPACY_IS_AVAILABLE</span><span class="p">:</span>
            <span class="k">global</span> <span class="n">nlp</span>  <span class="c1"># pylint: disable=global-statement,invalid-name</span>
            <span class="k">if</span> <span class="n">nlp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;pt_core_news_sm&quot;</span><span class="p">)</span>
            <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">lemma</span><span class="o">.</span><span class="n">lemma_</span><span class="p">])</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span> <span class="k">for</span> <span class="n">lemma</span> <span class="ow">in</span> <span class="n">nlp</span><span class="p">(</span><span class="n">word</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lemmatization skipped. Spacy modul is not installed.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">words</span></div>


<div class="viewcode-block" id="word_list_from_kindle"><a class="viewcode-back" href="../utils.html#utils.word_list_from_kindle">[docs]</a><span class="k">def</span> <span class="nf">word_list_from_kindle</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses :const:`MEANING2COLOR` `[&quot;words&quot;]` to extract the list of words highlighted in this specific color.</span>

<span class="sd">    Args:</span>
<span class="sd">      path: Path to html-file exported by kindle.</span>

<span class="sd">    Returns:</span>
<span class="sd">      : List of highlighted words.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">MEANING2COLOR</span><span class="p">[</span><span class="s2">&quot;words&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dict_from_kindle_export</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="n">color</span><span class="p">]</span></div>


<div class="viewcode-block" id="word_list_from_txt"><a class="viewcode-back" href="../utils.html#utils.word_list_from_txt">[docs]</a><span class="k">def</span> <span class="nf">word_list_from_txt</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">      path: Path to txt-file. Each line should correspond to a word (or phrase).</span>

<span class="sd">    Returns:</span>
<span class="sd">      : List of words.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">words</span></div>


<div class="viewcode-block" id="tag_word_in_sentence"><a class="viewcode-back" href="../utils.html#utils.tag_word_in_sentence">[docs]</a><span class="k">def</span> <span class="nf">tag_word_in_sentence</span><span class="p">(</span><span class="n">sentence</span><span class="p">,</span> <span class="n">tag_word</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses regex to wrap every derived form of a given ``tag_word`` in ``sentence`` in an html-tag.</span>

<span class="sd">    Args:</span>
<span class="sd">      sentence: String containing of multiple words.</span>
<span class="sd">      tag_word: Word that should be wrapped.</span>

<span class="sd">    Returns:</span>
<span class="sd">      : Sentence with replacements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">clean_up</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">lemmatize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># get unique, non-empty strings:</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="k">if</span> <span class="n">word</span><span class="p">]</span>
    <span class="n">lemmas</span> <span class="o">=</span> <span class="n">clean_up</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">lemmatize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lemmas</span><span class="p">)</span>
    <span class="n">tag_lemma</span> <span class="o">=</span> <span class="n">clean_up</span><span class="p">([</span><span class="n">tag_word</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">words_found</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">word</span>
        <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">lemma</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">lemmas</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lemma</span> <span class="o">==</span> <span class="n">tag_lemma</span> <span class="ow">or</span> <span class="n">word</span> <span class="o">==</span> <span class="n">tag_word</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words_found</span><span class="p">:</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;([^&gt;])(</span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2">)([^&lt;])&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s1">&#39;\1&lt;span class=&quot;word&quot;&gt;\2&lt;/span&gt;\3&#39;</span><span class="p">,</span>
            <span class="n">sentence</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">sentence</span></div>


<span class="c1"># Image resizing</span>


<div class="viewcode-block" id="compress_img"><a class="viewcode-back" href="../utils.html#utils.compress_img">[docs]</a><span class="k">def</span> <span class="nf">compress_img</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">512</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses the :class:`~PIL.Image` class to reduce the resolution of an image at ``path`` and overwrites it.</span>

<span class="sd">    If the image already has smaller width, nothing is done.</span>

<span class="sd">    Args:</span>
<span class="sd">      path: Path to image-file.</span>
<span class="sd">      width: New width of image (Default value = 512)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">width</span><span class="p">:</span>
        <span class="n">resize</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">width</span> <span class="o">*</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">resize</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">ANTIALIAS</span><span class="p">)</span>
    <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># pass</span>
    <span class="c1"># out = word_list_from_kindle(&quot;test/test_data/kindle_export.html&quot;)</span>
    <span class="c1"># print(out)</span>
    <span class="c1"># with open(&quot;test/test_data/words.txt&quot;, &quot;w&quot;) as file:</span>
    <span class="c1">#     file.write(&quot;\n&quot;.join(out))</span>

    <span class="c1"># example = (&quot;Construção em alvenaria usada como moradia, com distintos formatos ou tamanhos,&quot;</span>
    <span class="c1">#            &quot;normalmente térrea ou com dois andares. - Voltaire&quot;)</span>
    <span class="c1"># expl = (&quot;Os homens que procuram a felicidade são como os embriagados que não conseguem encontrar a própria casa, &quot;</span>
    <span class="c1">#         &quot;apesar de saberem que a têm. Test Casas, casa, casa.&quot;)</span>
    <span class="c1">#</span>
    <span class="c1"># print(tag_word(expl, &quot;casa&quot;))</span>
    <span class="c1"># compress_img(&quot;screenshots/casa/casa.jpg&quot;)</span>
    <span class="c1"># save_card_htmls(&quot;casa&quot;)#</span>
    <span class="n">save_card_pngs</span><span class="p">(</span><span class="s2">&quot;comecar&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">270</span> <span class="o">*</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mi">480</span> <span class="o">*</span> <span class="mf">1.4</span><span class="p">))</span>
</pre></div>

           </div>

          </div>
          <footer>


  <hr/>

  <div role="contentinfo">
    <p>

        &copy; Copyright 2020, David Fischer

    </p>
  </div>



    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a

    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>

    provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>






</body>
</html>
